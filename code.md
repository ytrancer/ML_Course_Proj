Background
----------

Using devices such as Jawbone Up, Nike FuelBand, and Fitbit it is now
possible to collect a large amount of data about personal activity
relatively inexpensively. These type of devices are part of the
quantified self movement – a group of enthusiasts who take measurements
about themselves regularly to improve their health, to find patterns in
their behavior, or because they are tech geeks. One thing that people
regularly do is quantify how much of a particular activity they do, but
they rarely quantify how well they do it. In this project, the goal will
be to use data from accelerometers on the belt, forearm, arm, and
dumbell of 6 participants. They were asked to perform barbell lifts
correctly and incorrectly in 5 different ways. More information is
available from the website here:
<a href="http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har" class="uri">http://web.archive.org/web/20161224072740/http:/groupware.les.inf.puc-rio.br/har</a>
(see the section on the Weight Lifting Exercise Dataset).

Getting the data
----------------

We’ll check if the data already exists locally and, if not, we download
it.

    # Get the training data

    train_fileurl <- 'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv'

    if (!file.exists('pml-training.csv')){
      download.file(train_fileurl,'./pml_training.csv')
      
    }

    train_df <- read.csv("pml_training.csv", na.strings=c("NA","#DIV/0!", ""))

    # Get the test data

    test_fileurl <- 'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv'

    if (!file.exists('pml-testing.csv')){
      download.file(train_fileurl,'./pml_testing.csv')
      
    }

    test_df <- read.csv("pml_testing.csv", na.strings=c("NA","#DIV/0!", ""))

EDA and Data Cleaning
---------------------

    glimpse(train_df)

    ## Observations: 19,622
    ## Variables: 160
    ## $ X                        <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12...
    ## $ user_name                <fct> carlitos, carlitos, carlitos, carlito...
    ## $ raw_timestamp_part_1     <int> 1323084231, 1323084231, 1323084231, 1...
    ## $ raw_timestamp_part_2     <int> 788290, 808298, 820366, 120339, 19632...
    ## $ cvtd_timestamp           <fct> 05/12/2011 11:23, 05/12/2011 11:23, 0...
    ## $ new_window               <fct> no, no, no, no, no, no, no, no, no, n...
    ## $ num_window               <int> 11, 11, 11, 12, 12, 12, 12, 12, 12, 1...
    ## $ roll_belt                <dbl> 1.41, 1.41, 1.42, 1.48, 1.48, 1.45, 1...
    ## $ pitch_belt               <dbl> 8.07, 8.07, 8.07, 8.05, 8.07, 8.06, 8...
    ## $ yaw_belt                 <dbl> -94.4, -94.4, -94.4, -94.4, -94.4, -9...
    ## $ total_accel_belt         <int> 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3...
    ## $ kurtosis_roll_belt       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ kurtosis_picth_belt      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ kurtosis_yaw_belt        <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_roll_belt       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_roll_belt.1     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_yaw_belt        <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_roll_belt            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_picth_belt           <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_yaw_belt             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_roll_belt            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_pitch_belt           <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_yaw_belt             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_roll_belt      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_pitch_belt     <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_yaw_belt       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_total_accel_belt     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_roll_belt            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_roll_belt         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_roll_belt            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_pitch_belt           <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_pitch_belt        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_pitch_belt           <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_yaw_belt             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_yaw_belt          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_yaw_belt             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ gyros_belt_x             <dbl> 0.00, 0.02, 0.00, 0.02, 0.02, 0.02, 0...
    ## $ gyros_belt_y             <dbl> 0.00, 0.00, 0.00, 0.00, 0.02, 0.00, 0...
    ## $ gyros_belt_z             <dbl> -0.02, -0.02, -0.02, -0.03, -0.02, -0...
    ## $ accel_belt_x             <int> -21, -22, -20, -22, -21, -21, -22, -2...
    ## $ accel_belt_y             <int> 4, 4, 5, 3, 2, 4, 3, 4, 2, 4, 2, 2, 4...
    ## $ accel_belt_z             <int> 22, 22, 23, 21, 24, 21, 21, 21, 24, 2...
    ## $ magnet_belt_x            <int> -3, -7, -2, -6, -6, 0, -4, -2, 1, -3,...
    ## $ magnet_belt_y            <int> 599, 608, 600, 604, 600, 603, 599, 60...
    ## $ magnet_belt_z            <int> -313, -311, -305, -310, -302, -312, -...
    ## $ roll_arm                 <dbl> -128, -128, -128, -128, -128, -128, -...
    ## $ pitch_arm                <dbl> 22.5, 22.5, 22.5, 22.1, 22.1, 22.0, 2...
    ## $ yaw_arm                  <dbl> -161, -161, -161, -161, -161, -161, -...
    ## $ total_accel_arm          <int> 34, 34, 34, 34, 34, 34, 34, 34, 34, 3...
    ## $ var_accel_arm            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_roll_arm             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_roll_arm          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_roll_arm             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_pitch_arm            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_pitch_arm         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_pitch_arm            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_yaw_arm              <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_yaw_arm           <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_yaw_arm              <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ gyros_arm_x              <dbl> 0.00, 0.02, 0.02, 0.02, 0.00, 0.02, 0...
    ## $ gyros_arm_y              <dbl> 0.00, -0.02, -0.02, -0.03, -0.03, -0....
    ## $ gyros_arm_z              <dbl> -0.02, -0.02, -0.02, 0.02, 0.00, 0.00...
    ## $ accel_arm_x              <int> -288, -290, -289, -289, -289, -289, -...
    ## $ accel_arm_y              <int> 109, 110, 110, 111, 111, 111, 111, 11...
    ## $ accel_arm_z              <int> -123, -125, -126, -123, -123, -122, -...
    ## $ magnet_arm_x             <int> -368, -369, -368, -372, -374, -369, -...
    ## $ magnet_arm_y             <int> 337, 337, 344, 344, 337, 342, 336, 33...
    ## $ magnet_arm_z             <int> 516, 513, 513, 512, 506, 513, 509, 51...
    ## $ kurtosis_roll_arm        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ kurtosis_picth_arm       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ kurtosis_yaw_arm         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_roll_arm        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_pitch_arm       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_yaw_arm         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_roll_arm             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_picth_arm            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_yaw_arm              <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_roll_arm             <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_pitch_arm            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_yaw_arm              <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_roll_arm       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_pitch_arm      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_yaw_arm        <int> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ roll_dumbbell            <dbl> 13.05217, 13.13074, 12.85075, 13.4312...
    ## $ pitch_dumbbell           <dbl> -70.49400, -70.63751, -70.27812, -70....
    ## $ yaw_dumbbell             <dbl> -84.87394, -84.71065, -85.14078, -84....
    ## $ kurtosis_roll_dumbbell   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ kurtosis_picth_dumbbell  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ kurtosis_yaw_dumbbell    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_roll_dumbbell   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_pitch_dumbbell  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_yaw_dumbbell    <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_roll_dumbbell        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_picth_dumbbell       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_yaw_dumbbell         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_roll_dumbbell        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_pitch_dumbbell       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_yaw_dumbbell         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_roll_dumbbell  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_pitch_dumbbell <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_yaw_dumbbell   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ total_accel_dumbbell     <int> 37, 37, 37, 37, 37, 37, 37, 37, 37, 3...
    ## $ var_accel_dumbbell       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_roll_dumbbell        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_roll_dumbbell     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_roll_dumbbell        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_pitch_dumbbell       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_pitch_dumbbell    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_pitch_dumbbell       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_yaw_dumbbell         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_yaw_dumbbell      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_yaw_dumbbell         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ gyros_dumbbell_x         <dbl> 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0...
    ## $ gyros_dumbbell_y         <dbl> -0.02, -0.02, -0.02, -0.02, -0.02, -0...
    ## $ gyros_dumbbell_z         <dbl> 0.00, 0.00, 0.00, -0.02, 0.00, 0.00, ...
    ## $ accel_dumbbell_x         <int> -234, -233, -232, -232, -233, -234, -...
    ## $ accel_dumbbell_y         <int> 47, 47, 46, 48, 48, 48, 47, 46, 47, 4...
    ## $ accel_dumbbell_z         <int> -271, -269, -270, -269, -270, -269, -...
    ## $ magnet_dumbbell_x        <int> -559, -555, -561, -552, -554, -558, -...
    ## $ magnet_dumbbell_y        <int> 293, 296, 298, 303, 292, 294, 295, 30...
    ## $ magnet_dumbbell_z        <dbl> -65, -64, -63, -60, -68, -66, -70, -7...
    ## $ roll_forearm             <dbl> 28.4, 28.3, 28.3, 28.1, 28.0, 27.9, 2...
    ## $ pitch_forearm            <dbl> -63.9, -63.9, -63.9, -63.9, -63.9, -6...
    ## $ yaw_forearm              <dbl> -153, -153, -152, -152, -152, -152, -...
    ## $ kurtosis_roll_forearm    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ kurtosis_picth_forearm   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ kurtosis_yaw_forearm     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_roll_forearm    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_pitch_forearm   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ skewness_yaw_forearm     <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_roll_forearm         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_picth_forearm        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ max_yaw_forearm          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_roll_forearm         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_pitch_forearm        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ min_yaw_forearm          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_roll_forearm   <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_pitch_forearm  <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ amplitude_yaw_forearm    <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ total_accel_forearm      <int> 36, 36, 36, 36, 36, 36, 36, 36, 36, 3...
    ## $ var_accel_forearm        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_roll_forearm         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_roll_forearm      <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_roll_forearm         <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_pitch_forearm        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_pitch_forearm     <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_pitch_forearm        <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ avg_yaw_forearm          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ stddev_yaw_forearm       <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ var_yaw_forearm          <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, N...
    ## $ gyros_forearm_x          <dbl> 0.03, 0.02, 0.03, 0.02, 0.02, 0.02, 0...
    ## $ gyros_forearm_y          <dbl> 0.00, 0.00, -0.02, -0.02, 0.00, -0.02...
    ## $ gyros_forearm_z          <dbl> -0.02, -0.02, 0.00, 0.00, -0.02, -0.0...
    ## $ accel_forearm_x          <int> 192, 192, 196, 189, 189, 193, 195, 19...
    ## $ accel_forearm_y          <int> 203, 203, 204, 206, 206, 203, 205, 20...
    ## $ accel_forearm_z          <int> -215, -216, -213, -214, -214, -215, -...
    ## $ magnet_forearm_x         <int> -17, -18, -18, -16, -17, -9, -18, -9,...
    ## $ magnet_forearm_y         <dbl> 654, 661, 658, 658, 655, 660, 659, 66...
    ## $ magnet_forearm_z         <dbl> 476, 473, 469, 469, 473, 478, 470, 47...
    ## $ classe                   <fct> A, A, A, A, A, A, A, A, A, A, A, A, A...

    ggplot(train_df, aes(x = classe)) + geom_density()

![](code_files/figure-markdown_strict/unnamed-chunk-2-1.png)

There are way too many NAs in the data set. If we want any meaningful
results we’ll have to do something about them. In this instance, I am
getting rid of the variables, which contain all NAs. Also, 1st to 7th
variables are irrelevant for this exersise, so we’ll delete them. There
are also quite a few near-zero values, which we are getting rid of.

    train_df <- train_df[,colSums(is.na(train_df)) == 0]
    train_df <- train_df[,-c(1:7)]

    test_df <- test_df[,colSums(is.na(test_df)) == 0]
    test_df <- test_df[,-c(1:7)]

    near_zero <- nearZeroVar(train_df, saveMetrics = TRUE)

    train_df <- train_df[, !near_zero$nzv]
    test_df <- test_df[, !near_zero$nzv]

Pre-processing
--------------

Now we are going to partition the **train\_df** into the training and
validation parts.

    test_split <- train_df %>% 
        initial_split(prop = 0.7, strata = "classe")

    data_training <- training(test_split)
    data_testing <- testing(test_split)

Now let’s fit some models.
--------------------------

    # Decision Tree

    fit_decTree <- rpart(classe ~ ., 
                         data = data_training, 
                         method = "class")
                         
    rpart.plot(fit_decTree)                    

    ## Warning: labs do not fit even at cex 0.15, there may be some overplotting

![](code_files/figure-markdown_strict/unnamed-chunk-5-1.png)

    # Random Forest

    fit_RF <- train(classe ~ ., 
                     data = data_training, 
                     method = "rf", 
                     trControl = trainControl(method = "cv", 5), 
                     ntree = 250)

    ## Warning: model fit failed for Fold3: mtry= 2 Error : cannot allocate vector of size 41.9 Mb

    ## Warning in nominalTrainWorkflow(x = x, y = y, wts = weights, info =
    ## trainInfo, : There were missing values in resampled performance measures.

Let’s have a look at the results

    pred_decTree <- predict(fit_decTree, data_testing, type = "class")
    confusionMatrix(pred_decTree, data_testing$classe)

    ## Confusion Matrix and Statistics
    ## 
    ##           Reference
    ## Prediction    A    B    C    D    E
    ##          A 1491  174   19   62   15
    ##          B   55  730   92   91   89
    ##          C   37  109  837  139  134
    ##          D   53   73   53  575   54
    ##          E   38   53   25   97  790
    ## 
    ## Overall Statistics
    ##                                           
    ##                Accuracy : 0.7516          
    ##                  95% CI : (0.7403, 0.7626)
    ##     No Information Rate : 0.2845          
    ##     P-Value [Acc > NIR] : < 2.2e-16       
    ##                                           
    ##                   Kappa : 0.6852          
    ##                                           
    ##  Mcnemar's Test P-Value : < 2.2e-16       
    ## 
    ## Statistics by Class:
    ## 
    ##                      Class: A Class: B Class: C Class: D Class: E
    ## Sensitivity            0.8907   0.6409   0.8158  0.59647   0.7301
    ## Specificity            0.9359   0.9311   0.9138  0.95265   0.9557
    ## Pos Pred Value         0.8467   0.6906   0.6664  0.71163   0.7876
    ## Neg Pred Value         0.9556   0.9153   0.9592  0.92338   0.9402
    ## Prevalence             0.2845   0.1935   0.1743  0.16381   0.1839
    ## Detection Rate         0.2534   0.1240   0.1422  0.09771   0.1342
    ## Detection Prevalence   0.2992   0.1796   0.2134  0.13730   0.1704
    ## Balanced Accuracy      0.9133   0.7860   0.8648  0.77456   0.8429

    pred_rf <- predict(fit_RF, data_testing, type = "raw")
    confusionMatrix(pred_rf, data_testing$classe)

    ## Confusion Matrix and Statistics
    ## 
    ##           Reference
    ## Prediction    A    B    C    D    E
    ##          A 1674    2    0    0    0
    ##          B    0 1137    6    0    0
    ##          C    0    0 1014    8    0
    ##          D    0    0    6  954    0
    ##          E    0    0    0    2 1082
    ## 
    ## Overall Statistics
    ##                                           
    ##                Accuracy : 0.9959          
    ##                  95% CI : (0.9939, 0.9974)
    ##     No Information Rate : 0.2845          
    ##     P-Value [Acc > NIR] : < 2.2e-16       
    ##                                           
    ##                   Kappa : 0.9948          
    ##                                           
    ##  Mcnemar's Test P-Value : NA              
    ## 
    ## Statistics by Class:
    ## 
    ##                      Class: A Class: B Class: C Class: D Class: E
    ## Sensitivity            1.0000   0.9982   0.9883   0.9896   1.0000
    ## Specificity            0.9995   0.9987   0.9984   0.9988   0.9996
    ## Pos Pred Value         0.9988   0.9948   0.9922   0.9937   0.9982
    ## Neg Pred Value         1.0000   0.9996   0.9975   0.9980   1.0000
    ## Prevalence             0.2845   0.1935   0.1743   0.1638   0.1839
    ## Detection Rate         0.2845   0.1932   0.1723   0.1621   0.1839
    ## Detection Prevalence   0.2848   0.1942   0.1737   0.1631   0.1842
    ## Balanced Accuracy      0.9998   0.9985   0.9933   0.9942   0.9998

Random Forest offers 0.99 accuracy against 0.74 on Decision Tree.
Therefore, we choose Random Forest. I am not aware of a meaningful way
to visualise what Random Forest has learned, but we can have a look at
it’s accuracy.

    fit_RF$finalModel

    ## 
    ## Call:
    ##  randomForest(x = x, y = y, ntree = 250, mtry = param$mtry) 
    ##                Type of random forest: classification
    ##                      Number of trees: 250
    ## No. of variables tried at each split: 27
    ## 
    ##         OOB estimate of  error rate: 0.68%
    ## Confusion matrix:
    ##      A    B    C    D    E class.error
    ## A 3902    3    0    0    1 0.001024066
    ## B   21 2629    8    0    0 0.010910459
    ## C    0   14 2371   11    0 0.010434057
    ## D    0    1   18 2229    4 0.010213144
    ## E    0    0    4    9 2512 0.005148515

As we can see, the out-of-sample error is extremely small.

    plot(fit_RF)

![](code_files/figure-markdown_strict/unnamed-chunk-10-1.png)
